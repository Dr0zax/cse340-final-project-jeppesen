<%- include('../../partials/header') %>
    <h1><%= title %></h1>

    <% if (requests && requests.length > 0) { %>
        <div class="requests">
            <% requests.forEach(request => { %>
                <div class="request-item">
                    <h3 class="request-header"><span><%= request.user_name %> - </span><%= request.vehicle_description %></h3>
                    <p class="request-vehicle_plate">Plate: <%= request.vehicle_plate %></p>
                    <p class="request-service_type">Type: <%= request.service_type %></p>
                    <p class="request-notes"><%= request.notes %></p>
                    <p class="request-date">Submitted: <%= new Date(request.created_at).toLocaleDateString() %></p>
                    <% if (loggedIn) { %>
                        <div class="actions-panel">
                        <% if (currentUser.role_name == "owner" || currentUser.role_name == "employee") { %>
                            <form method="POST" action="/service-requests/update-status" class="status-update-form">
                                <input type="hidden" name="requestId" value="<%= request.id %>">
                                <label for="status-<%= request.id %>">Status:</label>
                                <select name="status" id="status-<%= request.id %>" required>
                                    <option value="submitted" <%= request.status === 'submitted' ? 'selected' : '' %>>Submitted</option>
                                    <option value="in-progress" <%= request.status === 'in-progress' ? 'selected' : '' %>>In Progress</option>
                                    <option value="completed" <%= request.status === 'completed' ? 'selected' : '' %>>Completed</option>
                                    <option value="cancelled" <%= request.status === 'cancelled' ? 'selected' : '' %>>Cancelled</option>
                                </select>
                                <button type="submit" class="btn-update-status">Update Status</button>
                            </form>
                            <% } %>
                        <% if (currentUser.role_name == "owner" || currentUser.role_name == "employee" || currentUser.id === request.user_id) { %>
                            <form method="POST" action="/service-requests/<%= request.id %>/delete" class="delete-request-form" onsubmit="return confirm('Are you sure you want to delete this service request?');">
                                <button type="submit" class="btn-delete-request">Delete Request</button>
                            </form>
                        <% } %>
                        </div>
                    <% } %>  
                </div>
            <% }); %>
        </div>
    <% } else { %>
        <p class="no-requests">No service requests yet.</p>
    <% } %>
<%- include('../../partials/footer') %>